---
title: Get Data from Website
author: Yutong Dai
date: '2018-05-31'
categories:
  - R-Programming
tags:
  - R-tricks
slug: get-data-from-website
output:
  blogdown::html_page:
    toc: yes
summary: Use `R` funuctions to download datasets from websites and read `libsvm` formatted data. 
---


<div id="TOC">
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#solutions">Solutions</a><ul>
<li><a href="#download">Download</a></li>
<li><a href="#uncompress-data-files">Uncompress data files</a></li>
<li><a href="#load-libsvm-format-data">Load libsvm format data</a></li>
<li><a href="#complete-code">Complete Code</a></li>
</ul></li>
</ul>
</div>

<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>I’m using the datasets <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">libsvm</a> to do some numerical experiments. The sizes of datasets, like epsilon<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, are of severalGBs. So it is hard to play with the data on my desktop. I am lucky to run the experiments on a server. So my workflow is:</p>
<ol style="list-style-type: decimal">
<li>Download datasets on the server.</li>
<li>Preprocess datastes.</li>
<li>Run experiments.</li>
</ol>
<p>The problems I encounted are</p>
<ol style="list-style-type: decimal">
<li>How to use <code>R</code> functions to download data?</li>
<li>Since dataset files are compressed, how to uncompresse them?</li>
<li>How to read dataset are of the <code>libsvm</code> format?</li>
</ol>
</div>
<div id="solutions" class="section level1">
<h1>Solutions</h1>
<p>If you only care about the way to download datasets from R, then you can stop once finish reading the following subsection.</p>
<div id="download" class="section level2">
<h2>Download</h2>
<p>Use built-in function <code>download.file</code>, one can finish the task.</p>
<pre class="r"><code>download.file(target_path, path_filename_extension)</code></pre>
<p>For example,</p>
<pre class="r"><code>download.file(https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary/epsilon_normalized.bz2, &quot;./data/epsilon_normalized.bz2&quot;)</code></pre>
</div>
<div id="uncompress-data-files" class="section level2">
<h2>Uncompress data files</h2>
<p>Changce are that you datasets are compressed in <code>.zip</code>, <code>.bz2</code> and etc. formats, so you cannot directly load your data into the memory. You can use the function <code>bunzip2</code> from the <code>R.utils</code> packages.</p>
<pre class="r"><code>bunzip2(path_filet_to_uncompress, path_file_to_save, remove = FALSE, skip = TRUE)</code></pre>
<ul>
<li>remove: If TRUE, the compressed file will be removed once uncompression finished.</li>
<li>skip: If TRUE and the output file already exists, the output file is returned as is.</li>
</ul>
<p>For example,</p>
<pre><code>download.file(&quot;./data/epsilon_normalized.bz2&quot;, &quot;./data/epsilon_normalized&quot;)</code></pre>
<p>Here, the original dataset file <code>epsilon_normalized</code> has no extension.</p>
</div>
<div id="load-libsvm-format-data" class="section level2">
<h2>Load libsvm format data</h2>
<p>The libsvm format data is of form</p>
<pre><code>&lt;label&gt; &lt;index 1&gt;:&lt;value 1&gt; &lt;index 2&gt;:&lt;value 2&gt; ... &lt;index n&gt;:&lt;value n&gt;</code></pre>
<p>For example,</p>
<pre><code>1 1:12 2:34 3:56
2 1:98 2:76 3:65</code></pre>
<p>For more information, please refer to this <a href="https://stats.stackexchange.com/questions/61328/libsvm-data-format">post</a>.</p>
<p>We can use the <code>read.matrix.csr</code> function from the <code>e1071</code> package.</p>
<pre class="r"><code>data &lt;- read.matrix.csr(file, fac=TRUE)</code></pre>
<p>For example,</p>
<pre class="r"><code>data &lt;- read.matrix.csr(&quot;./data/epsilon_normalized&quot;, fac=TRUE)</code></pre>
<p>Note that <code>data</code> here is a list and matrix are stored in <code>sparse matrix</code> format. We can use <code>data$x</code> and <code>data$y</code> to extract the feature matrix and the label vector respectively.</p>
</div>
<div id="complete-code" class="section level2">
<h2>Complete Code</h2>
<p>The complete code to download and uncompress data files is</p>
<pre class="r"><code>get_data &lt;- function(target_path, save_path, save_name, extension, unzip=TRUE){
  path_file &lt;- paste(save_path,save_name,sep=&quot;/&quot;)
  path_file_extension &lt;- paste(path_file, extension, sep=&quot;.&quot;)
  download.file(target_path, path_file_extension)
  if (unzip){
    require(R.utils)
    bunzip2(path_file_extension, path_file, remove = FALSE, skip = TRUE)
    print(&quot;unzip finished!&quot;)
  }
  print(paste(&quot;data is strored at:&quot;, save_path))
}</code></pre>
<p>The complete code to load <code>libsvm</code> format data is</p>
<pre class="r"><code>process_data &lt;- function(file, convert_to_factor=FALSE){
  require(e1071)
  require(SparseM)
  print(&quot;loading data&quot;)
  data &lt;- read.matrix.csr(file, fac=convert_to_factor)
  print(&quot;loading finished&quot;)
  x &lt;- as.matrix(data$x)
  print(&quot;x was conveted to dense matrix form&quot;)
  y &lt;- as.matrix(data$y)
  results &lt;- list(x=x,y=y)
  return(results)
}</code></pre>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary/epsilon_normalized.bz2" class="uri">https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary/epsilon_normalized.bz2</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
