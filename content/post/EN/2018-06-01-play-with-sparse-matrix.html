---
title: Play with Sparse Matrix
author: Yutong Dai
date: '2018-06-01'
lastmod: '2018-06-01'
slug: play-with-sparse-matrix
categories:
  - R-Programming
tags:
  - R-tricks
output:
  blogdown::html_page:
    toc: yes
summary: "Play with sparse matirx using `SparseM`."
---


<div id="TOC">
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#solution">Solution</a><ul>
<li><a href="#slicing">Slicing</a></li>
<li><a href="#basic-linear-algebra-operations">Basic linear algebra operations</a></li>
</ul></li>
</ul>
</div>

<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>Recently, I have to deal with matrices with sparsity structures. If I coerce them using the <code>as.matrix</code> function, they consume my RAM wildly. So I turn to the package <a href="http://www.econ.uiuc.edu/~roger/research/sparse/SparseM.pdf">SparseM</a> for possible solutions.</p>
<p>What I want to do are,</p>
<ol style="list-style-type: decimal">
<li>Performe basic linear algebra operations on sparse matrices, mainly including multiplication, transpose, and etc.</li>
<li>Slice rows or columns by their indices.</li>
</ol>
<p>The package <code>SparseM</code> can perfectly fulfill my needs.</p>
</div>
<div id="solution" class="section level1">
<h1>Solution</h1>
<pre class="r"><code>set.seed(1234)
A &lt;- matrix(rnorm(16), ncol=4, nrow=4)
A[A &lt; 0] &lt;- 0
A</code></pre>
<pre><code>##           [,1]      [,2] [,3]       [,4]
## [1,] 0.0000000 0.4291247    0 0.00000000
## [2,] 0.2774292 0.5060559    0 0.06445882
## [3,] 1.0844412 0.0000000    0 0.95949406
## [4,] 0.0000000 0.0000000    0 0.00000000</code></pre>
<p>We reformat A in <code>csr</code> form:</p>
<pre class="r"><code>suppressMessages(library(SparseM)) 
A.csr &lt;- as.matrix.csr(A)
A.csr</code></pre>
<pre><code>## An object of class &quot;matrix.csr&quot;
## Slot &quot;ra&quot;:
## [1] 0.42912469 0.27742924 0.50605589 0.06445882 1.08444118 0.95949406
## 
## Slot &quot;ja&quot;:
## [1] 2 1 2 4 1 4
## 
## Slot &quot;ia&quot;:
## [1] 1 2 5 7 7
## 
## Slot &quot;dimension&quot;:
## [1] 4 4</code></pre>
<blockquote>
<p>ra: a real array of non-zero elements containing the non-zero elements of A, stored in row order. Thus, if i &lt; j, all elements of row i precede elements from row j. The order of elements within the rows is immaterial.</p>
</blockquote>
<blockquote>
<p>ja: an integer array of non-zero elements containing the column indices of the elements stored in ra.</p>
</blockquote>
<blockquote>
<p>ia: an integer array of n+1 elements containing pointers to the beginning of each row in the arrays ra and ja. Thus ia[i] indicates the position in the arrays ra and ja where the ith row begins. The last (n + 1)st element of ia indicates where the n + 1 row would start, if it existed.</p>
</blockquote>
<div id="slicing" class="section level2">
<h2>Slicing</h2>
<pre class="r"><code>A.csr[,1:2]</code></pre>
<pre><code>## An object of class &quot;matrix.csr&quot;
## Slot &quot;ra&quot;:
## [1] 0.4291247 0.2774292 0.5060559 1.0844412
## 
## Slot &quot;ja&quot;:
## [1] 2 1 2 1
## 
## Slot &quot;ia&quot;:
## [1] 1 2 4 5 5
## 
## Slot &quot;dimension&quot;:
## [1] 4 2</code></pre>
<pre class="r"><code>as.matrix(A.csr[,1:2])</code></pre>
<pre><code>##           [,1]      [,2]
## [1,] 0.0000000 0.4291247
## [2,] 0.2774292 0.5060559
## [3,] 1.0844412 0.0000000
## [4,] 0.0000000 0.0000000</code></pre>
<pre class="r"><code>A.csr[, -1]</code></pre>
<pre><code>## An object of class &quot;matrix.csr&quot;
## Slot &quot;ra&quot;:
## [1] 0.42912469 0.50605589 0.06445882 0.95949406
## 
## Slot &quot;ja&quot;:
## [1] 1 1 3 3
## 
## Slot &quot;ia&quot;:
## [1] 1 2 4 5 5
## 
## Slot &quot;dimension&quot;:
## [1] 4 3</code></pre>
<pre class="r"><code>as.matrix(A.csr[, -1])</code></pre>
<pre><code>##           [,1] [,2]       [,3]
## [1,] 0.4291247    0 0.00000000
## [2,] 0.5060559    0 0.06445882
## [3,] 0.0000000    0 0.95949406
## [4,] 0.0000000    0 0.00000000</code></pre>
</div>
<div id="basic-linear-algebra-operations" class="section level2">
<h2>Basic linear algebra operations</h2>
<pre class="r"><code>t(A.csr)</code></pre>
<pre><code>## An object of class &quot;matrix.csr&quot;
## Slot &quot;ra&quot;:
## [1] 0.27742924 1.08444118 0.42912469 0.50605589 0.06445882 0.95949406
## 
## Slot &quot;ja&quot;:
## [1] 2 3 1 2 2 3
## 
## Slot &quot;ia&quot;:
## [1] 1 3 5 5 7
## 
## Slot &quot;dimension&quot;:
## [1] 4 4</code></pre>
<pre class="r"><code>as.matrix(A.csr %*% c(1,2,3,4))</code></pre>
<pre><code>##           [,1]
## [1,] 0.8582494
## [2,] 1.5473763
## [3,] 4.9224174
## [4,] 0.0000000</code></pre>
<pre class="r"><code>A %*% c(1,2,3,4)</code></pre>
<pre><code>##           [,1]
## [1,] 0.8582494
## [2,] 1.5473763
## [3,] 4.9224174
## [4,] 0.0000000</code></pre>
<p>We can even visualize its sparse structure:</p>
<pre class="r"><code>set.seed(1234)
A &lt;- matrix(rnorm(2000), ncol=50, nrow=40)
A[abs(A) &lt; 0.7] &lt;- 0
image(as.matrix.csr(A))</code></pre>
<p><img src="/post/EN/2018-06-01-play-with-sparse-matrix_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
</div>
